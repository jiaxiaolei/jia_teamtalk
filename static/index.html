
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŒèƒ½æ²Ÿé€šç¿»è¯‘åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        .prose h3 { font-size: 1.1em; font-weight: bold; margin-top: 1em; color: #4B5563; }
        .prose ul { list-style-type: disc; padding-left: 1.5em; }
        .prose strong { color: #1F2937; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-8 text-gray-800">

    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-indigo-600 mb-2">ğŸ¤– èŒèƒ½æ²Ÿé€šç¿»è¯‘åŠ©æ‰‹</h1>
            <p class="text-gray-500">æ¶ˆé™¤ PM ä¸ Dev ä¹‹é—´çš„ç†è§£é¸¿æ²Ÿ</p>
        </header>

        <!-- Main Interface -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

            <!-- Left: Input -->
            <div class="bg-white p-6 rounded-xl shadow-md border border-gray-100">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ç¿»è¯‘æ¨¡å¼</label>
                    <select id="direction" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" onchange="updatePlaceholder()">
                        <option value="p2d">äº§å“ç»ç† â” å¼€å‘å·¥ç¨‹å¸ˆ</option>
                        <option value="d2p">å¼€å‘å·¥ç¨‹å¸ˆ â” äº§å“ç»ç†</option>
                    </select>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">è¾“å…¥å†…å®¹</label>
                    <textarea id="inputContent" rows="10"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none resize-none"
                        placeholder="è¯·è¾“å…¥éœ€æ±‚æè¿°..."></textarea>
                </div>

                <button onclick="startTranslate()"
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 flex justify-center items-center">
                    <span id="btnText">å¼€å§‹ç¿»è¯‘</span>
                    <div id="loading" class="hidden ml-2 w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                </button>
            </div>

            <!-- Right: Output -->
            <div class="bg-white p-6 rounded-xl shadow-md border border-gray-100 flex flex-col">
                <label class="block text-sm font-medium text-gray-700 mb-2">ç¿»è¯‘ç»“æœ</label>
                <div id="outputContent" class="flex-grow bg-gray-50 rounded-lg p-4 border border-gray-200 overflow-y-auto prose text-sm">
                    <p class="text-gray-400 italic">ç­‰å¾…è¾“å…¥...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const examples = {
            'p2d': 'æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ™ºèƒ½æ¨èåŠŸèƒ½ï¼Œæå‡ç”¨æˆ·åœç•™æ—¶é•¿ã€‚',
            'd2p': 'æˆ‘ä»¬ä¼˜åŒ–äº†æ•°æ®åº“æŸ¥è¯¢ï¼ŒQPSæå‡äº†30%ã€‚'
        };

        function updatePlaceholder() {
            const dir = document.getElementById('direction').value;
            const input = document.getElementById('inputContent');
            input.placeholder = `ä¾‹å¦‚ï¼š${examples[dir]}`;
        }

        async function startTranslate() {
            const direction = document.getElementById('direction').value;
            const content = document.getElementById('inputContent').value;
            const outputDiv = document.getElementById('outputContent');
            const btnText = document.getElementById('btnText');
            const loading = document.getElementById('loading');

            if (!content.trim()) {
                alert("è¯·è¾“å…¥å†…å®¹");
                return;
            }

            // UI Reset
            outputDiv.innerHTML = '<p class="text-gray-400 animate-pulse">AI æ­£åœ¨æ€è€ƒä¸­...</p>';
            btnText.innerText = "ç¿»è¯‘ä¸­...";
            loading.classList.remove('hidden');

            try {
                const response = await fetch('/api/translate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ direction, content })
                });

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let resultText = '';

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value, { stream: true });
                    // è¿™é‡Œçš„é€»è¾‘å–å†³äºåç«¯è¿”å›çš„æ˜¯å¢é‡è¿˜æ˜¯å…¨é‡ã€‚
                    // å‡è®¾ Dashscope SDK è¿”å›çš„æ˜¯ç´¯ç§¯å…¨é‡æ–‡æœ¬ï¼ˆä¸åŒæ¨¡å‹è¡Œä¸ºä¸ä¸€ï¼Œæ­¤å¤„æŒ‰å…¨é‡è¦†ç›–å¤„ç†æœ€ä¿é™©ï¼‰
                    // å¦‚æœåç«¯è¿”å›çš„æ˜¯"Hello" -> "Hello World"ï¼Œæˆ‘ä»¬å–æœ€åä¸€ä¸ªå®Œæ•´çš„åŒ…æœ€å¥½ã€‚
                    // ç®€åŒ–å¤„ç†ï¼šåœ¨è¿™ä¸ªDemoä¸­ï¼Œæˆ‘ä»¬å‡è®¾chunkæ˜¯ä¸€æ®µæ–‡æœ¬ï¼Œæˆ‘ä»¬æŠŠå®ƒæ‹¼èµ·æ¥ï¼Œ
                    // ä½†ç”±äºDashscopeæµå¼ç‰¹æ€§ï¼Œæœ€å¥½çš„æ–¹å¼å…¶å®æ˜¯åªä¿ç•™æœ€æ–°çš„é•¿æ–‡æœ¬ã€‚

                    // ä¿®æ­£é€»è¾‘ï¼šé’ˆå¯¹ç®€å•Demoï¼Œæˆ‘ä»¬ç›´æ¥è¿½åŠ å¯èƒ½ä¼šé‡å¤ã€‚
                    // å®é™…ä¸Šï¼Œä¸ºäº†æ•ˆæœï¼Œæˆ‘ä»¬æ¸…ç©ºå¹¶é‡å†™ï¼Œæˆ–è€…åç«¯åªå‘deltaã€‚
                    // è¿™é‡Œé‡‡ç”¨ç®€å•çš„è¦†ç›–ç­–ç•¥ï¼ˆè§†è§‰ä¸Šä¼šæœ‰é—ªçƒï¼Œä½†åœ¨2å°æ—¶æŒ‘æˆ˜ä¸­å¯æ¥å—ï¼‰ã€‚
                    resultText = chunk;

                    // æ›´å¥½çš„æµå¼ä½“éªŒæ˜¯åç«¯è®¡ç®—diffï¼Œä½†åœ¨æœ‰é™æ—¶é—´å†…ï¼Œ
                    // æˆ‘ä»¬è®©åç«¯æ¯æ¬¡yieldå½“å‰å®Œæ•´çš„ç”Ÿæˆç»“æœï¼Œå‰ç«¯ç›´æ¥è¦†ç›–innerHTMLã€‚
                    outputDiv.innerHTML = marked.parse(resultText);
                }

            } catch (error) {
                outputDiv.innerHTML = `<p class="text-red-500">å‘ç”Ÿé”™è¯¯: ${error.message}</p>`;
            } finally {
                btnText.innerText = "å¼€å§‹ç¿»è¯‘";
                loading.classList.add('hidden');
            }
        }

        // Init
        updatePlaceholder();
    </script>
</body>
</html>

